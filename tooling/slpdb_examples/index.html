<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SLPDB Examples</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#3a0839">
    <link rel="shortcut icon" href="/favicon.ico"><link rel='canonical' href='https://slp.dev/tooling/slpdb_examples/'/>
    <meta name="description" content="">
    <meta property="article:modified_time" content="2020-05-02T23:45:28.000Z">
    <meta property="og:title" content="SLPDB Examples">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://slp.dev/tooling/slpdb_examples/">
    <meta property="og:image" content="https://slp.dev/logo.png">
    <meta name="twitter:title" content="SLPDB Examples">
    <meta name="twitter:url" content="https://slp.dev/tooling/slpdb_examples/">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://slp.dev/logo.png">
    <meta name="image" content="https://slp.dev/logo.png">
    <meta name="msapplication-TileColor" content="#3a0839">
    <meta name="msapplication-config" content="/browserconfig.xml">
    <meta name="theme-color" content="#5bbad5">
    
    <link rel="preload" href="/assets/css/0.styles.a2612fed.css" as="style"><link rel="preload" href="/assets/js/app.727bd0bc.js" as="script"><link rel="preload" href="/assets/js/2.59409279.js" as="script"><link rel="preload" href="/assets/js/6.cb6c63cc.js" as="script"><link rel="preload" href="/assets/js/61.a94ff6cf.js" as="script"><link rel="prefetch" href="/assets/js/10.11bd2d6f.js"><link rel="prefetch" href="/assets/js/11.3448a0e0.js"><link rel="prefetch" href="/assets/js/12.5390e135.js"><link rel="prefetch" href="/assets/js/13.25949c46.js"><link rel="prefetch" href="/assets/js/14.8adf2b39.js"><link rel="prefetch" href="/assets/js/15.f57aebe1.js"><link rel="prefetch" href="/assets/js/16.a9988494.js"><link rel="prefetch" href="/assets/js/17.b632b9c1.js"><link rel="prefetch" href="/assets/js/18.579a7df4.js"><link rel="prefetch" href="/assets/js/19.07b36477.js"><link rel="prefetch" href="/assets/js/20.34496b79.js"><link rel="prefetch" href="/assets/js/21.aa9572ce.js"><link rel="prefetch" href="/assets/js/22.f611c7a9.js"><link rel="prefetch" href="/assets/js/23.fb176ab4.js"><link rel="prefetch" href="/assets/js/24.ae34a08d.js"><link rel="prefetch" href="/assets/js/25.a4764520.js"><link rel="prefetch" href="/assets/js/26.38ce89a0.js"><link rel="prefetch" href="/assets/js/27.b1edb44d.js"><link rel="prefetch" href="/assets/js/28.9dd2f0e6.js"><link rel="prefetch" href="/assets/js/29.b7ec60f2.js"><link rel="prefetch" href="/assets/js/3.8e11cb09.js"><link rel="prefetch" href="/assets/js/30.b3de8cee.js"><link rel="prefetch" href="/assets/js/31.71a279fa.js"><link rel="prefetch" href="/assets/js/32.5bad9125.js"><link rel="prefetch" href="/assets/js/33.29483670.js"><link rel="prefetch" href="/assets/js/34.42841138.js"><link rel="prefetch" href="/assets/js/35.b99d13bf.js"><link rel="prefetch" href="/assets/js/36.3ce31b1a.js"><link rel="prefetch" href="/assets/js/37.c0523623.js"><link rel="prefetch" href="/assets/js/38.f40e6826.js"><link rel="prefetch" href="/assets/js/39.690a7325.js"><link rel="prefetch" href="/assets/js/4.e08ed9f2.js"><link rel="prefetch" href="/assets/js/40.e3acd5f1.js"><link rel="prefetch" href="/assets/js/41.da4e1119.js"><link rel="prefetch" href="/assets/js/42.f9a30f27.js"><link rel="prefetch" href="/assets/js/43.7f8a50cc.js"><link rel="prefetch" href="/assets/js/44.8e978a53.js"><link rel="prefetch" href="/assets/js/45.92a7fe60.js"><link rel="prefetch" href="/assets/js/46.0072c31d.js"><link rel="prefetch" href="/assets/js/47.d0b4a172.js"><link rel="prefetch" href="/assets/js/48.56897b92.js"><link rel="prefetch" href="/assets/js/49.01e5e0b1.js"><link rel="prefetch" href="/assets/js/5.276ce48f.js"><link rel="prefetch" href="/assets/js/50.e5c0199d.js"><link rel="prefetch" href="/assets/js/51.a3b63ce1.js"><link rel="prefetch" href="/assets/js/52.c689335b.js"><link rel="prefetch" href="/assets/js/53.27b0e617.js"><link rel="prefetch" href="/assets/js/54.90baf352.js"><link rel="prefetch" href="/assets/js/55.75e41a49.js"><link rel="prefetch" href="/assets/js/56.0f4c2dcd.js"><link rel="prefetch" href="/assets/js/57.9fa9f121.js"><link rel="prefetch" href="/assets/js/58.278c7677.js"><link rel="prefetch" href="/assets/js/59.e147c217.js"><link rel="prefetch" href="/assets/js/60.21d56b27.js"><link rel="prefetch" href="/assets/js/62.cfc1d4fb.js"><link rel="prefetch" href="/assets/js/63.ecb1ff64.js"><link rel="prefetch" href="/assets/js/64.5f630325.js"><link rel="prefetch" href="/assets/js/65.29333f2d.js"><link rel="prefetch" href="/assets/js/66.07e30d95.js"><link rel="prefetch" href="/assets/js/67.f1a6158d.js"><link rel="prefetch" href="/assets/js/68.e90e7a5e.js"><link rel="prefetch" href="/assets/js/7.0ad4cf60.js"><link rel="prefetch" href="/assets/js/8.3cd91f71.js"><link rel="prefetch" href="/assets/js/9.14c39fac.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a2612fed.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/slp-documentation-logo.svg" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/get-started/" class="sidebar-link">Get Started</a></li><li><a href="/terminology/" class="sidebar-link">Terminology</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Specifications</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Guides</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Packages</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Tooling</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tooling/overview/" class="sidebar-link">Overview</a></li><li><a href="/tooling/explorer/" class="sidebar-link">Explorer</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Testing</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>SLPDB</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tooling/slpdb/" class="sidebar-link">SLPDB</a></li><li><a href="/tooling/slpdb_examples/" aria-current="page" class="active sidebar-link">SLPDB Examples</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tooling/slpdb_examples/#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/tooling/slpdb_examples/#general-queries" class="sidebar-link">General Queries</a></li><li class="sidebar-sub-header"><a href="/tooling/slpdb_examples/#counting" class="sidebar-link">Counting</a></li><li class="sidebar-sub-header"><a href="/tooling/slpdb_examples/#dividend-calculations" class="sidebar-link">Dividend Calculations</a></li></ul></li><li><a href="/tooling/slpserve/" class="sidebar-link">SLPServe</a></li><li><a href="/tooling/slpsocket/" class="sidebar-link">SLPSocket</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>GS++</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>BCHD</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Servers</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Wallets</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Defunct / Broken</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><a href="/community/" class="sidebar-link">Community</a></li></ul> </aside> <main class="page" data-v-4c735fbc> <div class="theme-default-content content__default" data-v-4c735fbc><h1 id="slpdb-examples"><a href="#slpdb-examples" class="header-anchor">#</a> SLPDB Examples</h1> <h4 id="table-of-contents"><a href="#table-of-contents" class="header-anchor">#</a> Table of contents</h4> <p></p><div class="table-of-contents"><ul><li><a href="#introduction">Introduction</a><ul><li><a href="#how-to-query-slpdb">How to Query SLPDB</a></li></ul></li><li><a href="#general-queries">General Queries</a><ul><li><a href="#get-all-tokens">Get All Tokens</a></li><li><a href="#token-transaction-history">Token Transaction History</a></li><li><a href="#look-up-transaction-by-txid">Look up Transaction by TXID</a></li><li><a href="#transactions-in-a-block">Transactions in a Block</a></li><li><a href="#transactions-in-mempool">Transactions in Mempool</a></li><li><a href="#look-up-token-by-tokenidhex">Look up Token By tokenIdHex</a></li><li><a href="#look-up-multiple-tokens-in-one-query">Look up Multiple Tokens in one Query</a></li><li><a href="#look-up-all-addresses-associated-with-a-token">Look up All Addresses associated with a Token</a></li><li><a href="#token-mint-history">Token Mint History</a></li><li><a href="#token-burn-history">Token Burn History</a></li><li><a href="#address-burn-history">Address Burn History</a></li><li><a href="#get-burn-history-of-all-tokens">Get Burn History of all Tokens</a></li><li><a href="#token-child-nfts">Token Child NFTs</a></li><li><a href="#recent-transactions">Recent transactions</a></li><li><a href="#transactions-involving-address">Transactions involving address</a></li><li><a href="#tokens-by-slp-address">Tokens by SLP Address</a></li><li><a href="#recently-created-tokens">Recently created tokens</a></li></ul></li><li><a href="#counting">Counting</a><ul><li><a href="#count-total-tokens">Count Total Tokens</a></li><li><a href="#count-total-tokens-minted">Count Total Tokens Minted</a></li><li><a href="#count-unconfirmed-transaction-history">Count Unconfirmed Transaction History</a></li><li><a href="#count-transactions-by-block">Count Transactions By Block</a></li><li><a href="#count-transactions-in-mempool">Count Transactions in Mempool</a></li><li><a href="#count-total-mints-for-a-token">Count Total Mints for a Token</a></li><li><a href="#count-total-burned-tokens">Count Total Burned Tokens</a></li><li><a href="#count-total-satoshis-locked-up">Count Total Satoshis Locked Up</a></li><li><a href="#count-total-tokens-minted">Count Total Tokens Minted</a></li><li><a href="#count-tokens-total-transactions">Count Tokens Total Transactions</a></li><li><a href="#count-utxos-involving-a-token">Count UTXOs Involving a Token</a></li><li><a href="#count-total-addresses-associated-with-a-token">Count Total Addresses associated with a Token</a></li><li><a href="#count-token-burn-transactions">Count Token Burn Transactions</a></li><li><a href="#count-an-addresses-total-burn-transactions">Count an Addresses Total Burn Transactions</a></li><li><a href="#count-total-token-burn-transactions">Count Total Token Burn Transactions</a></li><li><a href="#count-of-tokens-an-address-holds">Count of Tokens an Address Holds</a></li><li><a href="#total-transactions-by-address">Total Transactions by Address</a></li><li><a href="#count-address-s-sent-transactions">Count Address's Sent Transactions</a></li><li><a href="#count-address-s-received-transactions">Count Address's Received Transactions</a></li></ul></li><li><a href="#dividend-calculations">Dividend Calculations</a><ul><li><a href="#calculate-dividends-from-mempool">Calculate Dividends from Mempool</a></li><li><a href="#dividend-ignore-amount-from-mempool">Dividend Ignore Amount from Mempool</a></li></ul></li></ul></div><p></p> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <h3 id="how-to-query-slpdb"><a href="#how-to-query-slpdb" class="header-anchor">#</a> How to Query SLPDB</h3> <p>The following examples assume a similar implementation as the following to query SLPDB. <code>fetch_retry</code> is used to deal with occassional network errors, and <code>btoa_ext</code> is a nice way to ensure we can handle the full range of possible characters (such as querying some Chinese characters). If you are using SLPDB from a browser, browserify, babel, and other tools provide a Buffer implementation.</p> <p>The core idea to this is to take JSON and convert it into a string, then convert that to base64, and perform a GET request to a SLPServe server.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fetch <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node-fetch'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">fetch_retry</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options<span class="token punctuation">,</span> n<span class="token operator">=</span><span class="token number">5</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> error<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">fetch_retry</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> options<span class="token punctuation">,</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">btoa_ext</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">buf</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">query</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">query</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> b64 <span class="token operator">=</span> <span class="token function">btoa_ext</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'https://slpdb.fountainhead.cash/q/'</span> <span class="token operator">+</span> b64<span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">fetch_retry</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> r <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>r<span class="token punctuation">[</span><span class="token string">'error'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="general-queries"><a href="#general-queries" class="header-anchor">#</a> General Queries</h2> <h3 id="get-all-tokens"><a href="#get-all-tokens" class="header-anchor">#</a> Get All Tokens</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">all_tokens</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">limit<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> skip<span class="token operator">=</span><span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'find'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'sort'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'tokenStats.approx_txns_since_genesis'</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'limit'</span><span class="token operator">:</span> limit<span class="token punctuation">,</span>
    <span class="token string">'skip'</span><span class="token operator">:</span> skip<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="token-transaction-history"><a href="#token-transaction-history" class="header-anchor">#</a> Token Transaction History</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">token_transaction_history_query_generator</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> tokenIdHex<span class="token punctuation">,</span> address<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">,</span> limit<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> skip<span class="token operator">=</span><span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> q <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span>db<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">'find'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'$and'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span><span class="token string">'slp.valid'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span><span class="token string">'slp.detail.tokenIdHex'</span><span class="token operator">:</span> tokenIdHex<span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">'sort'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'blk.i'</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">'limit'</span><span class="token operator">:</span> limit<span class="token punctuation">,</span>
      <span class="token string">'skip'</span><span class="token operator">:</span> skip<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>address <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    q<span class="token punctuation">[</span><span class="token string">'q'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'find'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'$query'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'$or'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span><span class="token string">'in.e.a'</span><span class="token operator">:</span> address<span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span><span class="token string">'out.e.a'</span><span class="token operator">:</span> address<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> q<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">unconfirmed_token_transaction_history</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tokenIdHex<span class="token punctuation">,</span> address<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">,</span> limit<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> skip<span class="token operator">=</span><span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token function">token_transaction_history_query_generator</span><span class="token punctuation">(</span><span class="token string">'u'</span><span class="token punctuation">,</span> tokenIdHex<span class="token punctuation">,</span> address<span class="token punctuation">,</span> limit<span class="token punctuation">,</span> skip<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function-variable function">confirmed_token_transaction_history</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tokenIdHex<span class="token punctuation">,</span> address<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">,</span> limit<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> skip<span class="token operator">=</span><span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token function">token_transaction_history_query_generator</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">,</span> tokenIdHex<span class="token punctuation">,</span> address<span class="token punctuation">,</span> limit<span class="token punctuation">,</span> skip<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="look-up-transaction-by-txid"><a href="#look-up-transaction-by-txid" class="header-anchor">#</a> Look up Transaction by TXID</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">tx</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">txid</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'u'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'tx.h'</span><span class="token operator">:</span> txid<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$limit'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$lookup'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'from'</span><span class="token operator">:</span> <span class="token string">'graphs'</span><span class="token punctuation">,</span>
          <span class="token string">'localField'</span><span class="token operator">:</span> <span class="token string">'tx.h'</span><span class="token punctuation">,</span>
          <span class="token string">'foreignField'</span><span class="token operator">:</span> <span class="token string">'graphTxn.txid'</span><span class="token punctuation">,</span>
          <span class="token string">'as'</span><span class="token operator">:</span> <span class="token string">'graph'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$lookup'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'from'</span><span class="token operator">:</span> <span class="token string">'tokens'</span><span class="token punctuation">,</span>
          <span class="token string">'localField'</span><span class="token operator">:</span> <span class="token string">'slp.detail.tokenIdHex'</span><span class="token punctuation">,</span>
          <span class="token string">'foreignField'</span><span class="token operator">:</span> <span class="token string">'tokenDetails.tokenIdHex'</span><span class="token punctuation">,</span>
          <span class="token string">'as'</span><span class="token operator">:</span> <span class="token string">'token'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'limit'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="transactions-in-a-block"><a href="#transactions-in-a-block" class="header-anchor">#</a> Transactions in a Block</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">txs_by_block</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">height<span class="token punctuation">,</span> limit<span class="token operator">=</span><span class="token number">150</span><span class="token punctuation">,</span> skip<span class="token operator">=</span><span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'$and'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span><span class="token string">'slp.valid'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token string">'blk.i'</span><span class="token operator">:</span> height<span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$skip'</span><span class="token operator">:</span> skip<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$limit'</span><span class="token operator">:</span> limit<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$lookup'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'from'</span><span class="token operator">:</span> <span class="token string">'tokens'</span><span class="token punctuation">,</span>
          <span class="token string">'localField'</span><span class="token operator">:</span> <span class="token string">'slp.detail.tokenIdHex'</span><span class="token punctuation">,</span>
          <span class="token string">'foreignField'</span><span class="token operator">:</span> <span class="token string">'tokenDetails.tokenIdHex'</span><span class="token punctuation">,</span>
          <span class="token string">'as'</span><span class="token operator">:</span> <span class="token string">'token'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'limit'</span><span class="token operator">:</span> limit<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="transactions-in-mempool"><a href="#transactions-in-mempool" class="header-anchor">#</a> Transactions in Mempool</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">txs_in_mempool</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">limit<span class="token operator">=</span><span class="token number">150</span><span class="token punctuation">,</span> skip<span class="token operator">=</span><span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'u'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'slp.valid'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$skip'</span><span class="token operator">:</span> skip<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$limit'</span><span class="token operator">:</span> limit<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$lookup'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'from'</span><span class="token operator">:</span> <span class="token string">'tokens'</span><span class="token punctuation">,</span>
          <span class="token string">'localField'</span><span class="token operator">:</span> <span class="token string">'slp.detail.tokenIdHex'</span><span class="token punctuation">,</span>
          <span class="token string">'foreignField'</span><span class="token operator">:</span> <span class="token string">'tokenDetails.tokenIdHex'</span><span class="token punctuation">,</span>
          <span class="token string">'as'</span><span class="token operator">:</span> <span class="token string">'token'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'limit'</span><span class="token operator">:</span> limit<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="look-up-token-by-tokenidhex"><a href="#look-up-token-by-tokenidhex" class="header-anchor">#</a> Look up Token By tokenIdHex</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">token</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tokenIdHex</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'find'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'tokenDetails.tokenIdHex'</span><span class="token operator">:</span> tokenIdHex<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'limit'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="look-up-multiple-tokens-in-one-query"><a href="#look-up-multiple-tokens-in-one-query" class="header-anchor">#</a> Look up Multiple Tokens in one Query</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">tokens</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tokenIdHexs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'find'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'tokenDetails.tokenIdHex'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'$in'</span><span class="token operator">:</span> tokenIdHexs<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'limit'</span><span class="token operator">:</span> tokenIdHexs<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="look-up-all-addresses-associated-with-a-token"><a href="#look-up-all-addresses-associated-with-a-token" class="header-anchor">#</a> Look up All Addresses associated with a Token</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">token_addresses</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tokenIdHex<span class="token punctuation">,</span> limit<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> skip<span class="token operator">=</span><span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'g'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'tokenDetails.tokenIdHex'</span><span class="token operator">:</span> tokenIdHex<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$unwind'</span><span class="token operator">:</span> <span class="token string">'$graphTxn.outputs'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'graphTxn.outputs.status'</span><span class="token operator">:</span> <span class="token string">'UNSPENT'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token string">'$graphTxn.outputs.address'</span><span class="token punctuation">,</span>
          <span class="token string">'slpAmount'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$sum'</span><span class="token operator">:</span> <span class="token string">'$graphTxn.outputs.slpAmount'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'slpAmount'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$gt'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'sort'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'slpAmount'</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'project'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'address'</span><span class="token operator">:</span> <span class="token string">'$_id'</span><span class="token punctuation">,</span>
      <span class="token string">'token_balance'</span><span class="token operator">:</span> <span class="token string">'$slpAmount'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'limit'</span><span class="token operator">:</span> limit<span class="token punctuation">,</span>
    <span class="token string">'skip'</span><span class="token operator">:</span> skip<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="token-mint-history"><a href="#token-mint-history" class="header-anchor">#</a> Token Mint History</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">token_mint_history</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tokenIdHex<span class="token punctuation">,</span> limit<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> skip<span class="token operator">=</span><span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'u'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'find'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'slp.valid'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token string">'slp.detail.tokenIdHex'</span><span class="token operator">:</span> tokenIdHex<span class="token punctuation">,</span>
      <span class="token string">'$or'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token string">'slp.detail.transactionType'</span><span class="token operator">:</span> <span class="token string">'GENESIS'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token string">'slp.detail.transactionType'</span><span class="token operator">:</span> <span class="token string">'MINT'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'sort'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'blk.i'</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'limit'</span><span class="token operator">:</span> limit<span class="token punctuation">,</span>
    <span class="token string">'skip'</span><span class="token operator">:</span> skip<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="token-burn-history"><a href="#token-burn-history" class="header-anchor">#</a> Token Burn History</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">token_burn_history</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tokenIdHex<span class="token punctuation">,</span> limit<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> skip<span class="token operator">=</span><span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'g'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'tokenDetails.tokenIdHex'</span><span class="token operator">:</span> tokenIdHex<span class="token punctuation">,</span>
          <span class="token string">'graphTxn.outputs'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$elemMatch'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string">'status'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string">'$in'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                  <span class="token string">'SPENT_NON_SLP'</span><span class="token punctuation">,</span>
                  <span class="token string">'BATON_SPENT_INVALID_SLP'</span><span class="token punctuation">,</span>
                  <span class="token string">'SPENT_INVALID_SLP'</span><span class="token punctuation">,</span>
                  <span class="token string">'BATON_SPENT_NON_SLP'</span><span class="token punctuation">,</span>
                  <span class="token string">'MISSING_BCH_VOUT'</span><span class="token punctuation">,</span>
                  <span class="token string">'BATON_MISSING_BCH_VOUT'</span><span class="token punctuation">,</span>
                  <span class="token string">'BATON_SPENT_NOT_IN_MINT'</span><span class="token punctuation">,</span>
                  <span class="token string">'EXCESS_INPUT_BURNED'</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string">'slpAmount'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string">'$gt'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$lookup'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'from'</span><span class="token operator">:</span> <span class="token string">'confirmed'</span><span class="token punctuation">,</span>
          <span class="token string">'localField'</span><span class="token operator">:</span> <span class="token string">'graphTxn.txid'</span><span class="token punctuation">,</span>
          <span class="token string">'foreignField'</span><span class="token operator">:</span> <span class="token string">'tx.h'</span><span class="token punctuation">,</span>
          <span class="token string">'as'</span><span class="token operator">:</span> <span class="token string">'tx'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$sort'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'tx.blk.i'</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$skip'</span><span class="token operator">:</span> skip<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$limit'</span><span class="token operator">:</span> limit<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="address-burn-history"><a href="#address-burn-history" class="header-anchor">#</a> Address Burn History</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">address_burn_history</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">address<span class="token punctuation">,</span> limit<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> skip<span class="token operator">=</span><span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'g'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'$or'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              <span class="token string">'graphTxn.outputs'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string">'$elemMatch'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token string">'address'</span><span class="token operator">:</span> address<span class="token punctuation">,</span>
                  <span class="token string">'status'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token string">'$in'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                      <span class="token string">'SPENT_NON_SLP'</span><span class="token punctuation">,</span>
                      <span class="token string">'BATON_SPENT_INVALID_SLP'</span><span class="token punctuation">,</span>
                      <span class="token string">'SPENT_INVALID_SLP'</span><span class="token punctuation">,</span>
                      <span class="token string">'BATON_SPENT_NON_SLP'</span><span class="token punctuation">,</span>
                      <span class="token string">'MISSING_BCH_VOUT'</span><span class="token punctuation">,</span>
                      <span class="token string">'BATON_MISSING_BCH_VOUT'</span><span class="token punctuation">,</span>
                      <span class="token string">'BATON_SPENT_NOT_IN_MINT'</span><span class="token punctuation">,</span>
                      <span class="token string">'EXCESS_INPUT_BURNED'</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token string">'slpAmount'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token string">'$gt'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              <span class="token string">'graphTxn.inputs.address'</span><span class="token operator">:</span> address<span class="token punctuation">,</span>
              <span class="token string">'graphTxn.outputs'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string">'$elemMatch'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token string">'status'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token string">'$in'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                      <span class="token string">'SPENT_NON_SLP'</span><span class="token punctuation">,</span>
                      <span class="token string">'BATON_SPENT_INVALID_SLP'</span><span class="token punctuation">,</span>
                      <span class="token string">'SPENT_INVALID_SLP'</span><span class="token punctuation">,</span>
                      <span class="token string">'BATON_SPENT_NON_SLP'</span><span class="token punctuation">,</span>
                      <span class="token string">'MISSING_BCH_VOUT'</span><span class="token punctuation">,</span>
                      <span class="token string">'BATON_MISSING_BCH_VOUT'</span><span class="token punctuation">,</span>
                      <span class="token string">'BATON_SPENT_NOT_IN_MINT'</span><span class="token punctuation">,</span>
                      <span class="token string">'EXCESS_INPUT_BURNED'</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token string">'slpAmount'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token string">'$gt'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$lookup'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'from'</span><span class="token operator">:</span> <span class="token string">'confirmed'</span><span class="token punctuation">,</span>
          <span class="token string">'localField'</span><span class="token operator">:</span> <span class="token string">'graphTxn.txid'</span><span class="token punctuation">,</span>
          <span class="token string">'foreignField'</span><span class="token operator">:</span> <span class="token string">'tx.h'</span><span class="token punctuation">,</span>
          <span class="token string">'as'</span><span class="token operator">:</span> <span class="token string">'tx'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$lookup'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'from'</span><span class="token operator">:</span> <span class="token string">'tokens'</span><span class="token punctuation">,</span>
          <span class="token string">'localField'</span><span class="token operator">:</span> <span class="token string">'tx.slp.detail.tokenIdHex'</span><span class="token punctuation">,</span>
          <span class="token string">'foreignField'</span><span class="token operator">:</span> <span class="token string">'tokenDetails.tokenIdHex'</span><span class="token punctuation">,</span>
          <span class="token string">'as'</span><span class="token operator">:</span> <span class="token string">'token'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$sort'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'tx.blk.i'</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$skip'</span><span class="token operator">:</span> skip<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$limit'</span><span class="token operator">:</span> limit<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="get-burn-history-of-all-tokens"><a href="#get-burn-history-of-all-tokens" class="header-anchor">#</a> Get Burn History of all Tokens</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">total_burn_history</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">limit<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> skip<span class="token operator">=</span><span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'g'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'graphTxn.outputs'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$elemMatch'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string">'status'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string">'$in'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                  <span class="token string">'SPENT_NON_SLP'</span><span class="token punctuation">,</span>
                  <span class="token string">'BATON_SPENT_INVALID_SLP'</span><span class="token punctuation">,</span>
                  <span class="token string">'SPENT_INVALID_SLP'</span><span class="token punctuation">,</span>
                  <span class="token string">'BATON_SPENT_NON_SLP'</span><span class="token punctuation">,</span>
                  <span class="token string">'MISSING_BCH_VOUT'</span><span class="token punctuation">,</span>
                  <span class="token string">'BATON_MISSING_BCH_VOUT'</span><span class="token punctuation">,</span>
                  <span class="token string">'BATON_SPENT_NOT_IN_MINT'</span><span class="token punctuation">,</span>
                  <span class="token string">'EXCESS_INPUT_BURNED'</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string">'slpAmount'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string">'$gt'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$lookup'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'from'</span><span class="token operator">:</span> <span class="token string">'confirmed'</span><span class="token punctuation">,</span>
          <span class="token string">'localField'</span><span class="token operator">:</span> <span class="token string">'graphTxn.txid'</span><span class="token punctuation">,</span>
          <span class="token string">'foreignField'</span><span class="token operator">:</span> <span class="token string">'tx.h'</span><span class="token punctuation">,</span>
          <span class="token string">'as'</span><span class="token operator">:</span> <span class="token string">'tx'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$lookup'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'from'</span><span class="token operator">:</span> <span class="token string">'tokens'</span><span class="token punctuation">,</span>
          <span class="token string">'localField'</span><span class="token operator">:</span> <span class="token string">'tx.slp.detail.tokenIdHex'</span><span class="token punctuation">,</span>
          <span class="token string">'foreignField'</span><span class="token operator">:</span> <span class="token string">'tokenDetails.tokenIdHex'</span><span class="token punctuation">,</span>
          <span class="token string">'as'</span><span class="token operator">:</span> <span class="token string">'token'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$sort'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'tx.blk.i'</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$skip'</span><span class="token operator">:</span> skip<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$limit'</span><span class="token operator">:</span> limit<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="token-child-nfts"><a href="#token-child-nfts" class="header-anchor">#</a> Token Child NFTs</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">token_child_nfts</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tokenIdHex<span class="token punctuation">,</span> limit<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> skip<span class="token operator">=</span><span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'nftParentId'</span><span class="token operator">:</span> tokenIdHex<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$sort'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'tokenStats.block_created'</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$skip'</span><span class="token operator">:</span> skip<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$limit'</span><span class="token operator">:</span> limit<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="recent-transactions"><a href="#recent-transactions" class="header-anchor">#</a> Recent transactions</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">recent_transactions</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">limit<span class="token operator">=</span><span class="token number">150</span><span class="token punctuation">,</span> skip<span class="token operator">=</span><span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'u'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'slp.valid'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token string">'slp.detail.transactionType'</span><span class="token operator">:</span> <span class="token string">'SEND'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$sort'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$skip'</span><span class="token operator">:</span> skip<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$limit'</span><span class="token operator">:</span> limit<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$lookup'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'from'</span><span class="token operator">:</span> <span class="token string">'tokens'</span><span class="token punctuation">,</span>
          <span class="token string">'localField'</span><span class="token operator">:</span> <span class="token string">'slp.detail.tokenIdHex'</span><span class="token punctuation">,</span>
          <span class="token string">'foreignField'</span><span class="token operator">:</span> <span class="token string">'tokenDetails.tokenIdHex'</span><span class="token punctuation">,</span>
          <span class="token string">'as'</span><span class="token operator">:</span> <span class="token string">'token'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'limit'</span><span class="token operator">:</span> limit<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="transactions-involving-address"><a href="#transactions-involving-address" class="header-anchor">#</a> Transactions involving address</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">transactions_by_slp_address</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> address<span class="token punctuation">,</span> limit<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> skip<span class="token operator">=</span><span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span>db<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'$and'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span><span class="token string">'slp.valid'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              <span class="token string">'$or'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span><span class="token string">'in.e.a'</span><span class="token operator">:</span> address<span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span><span class="token string">'out.e.a'</span><span class="token operator">:</span> address<span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$sort'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'blk.i'</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$skip'</span><span class="token operator">:</span> skip<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$limit'</span><span class="token operator">:</span> limit<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$lookup'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'from'</span><span class="token operator">:</span> <span class="token string">'tokens'</span><span class="token punctuation">,</span>
          <span class="token string">'localField'</span><span class="token operator">:</span> <span class="token string">'slp.detail.tokenIdHex'</span><span class="token punctuation">,</span>
          <span class="token string">'foreignField'</span><span class="token operator">:</span> <span class="token string">'tokenDetails.tokenIdHex'</span><span class="token punctuation">,</span>
          <span class="token string">'as'</span><span class="token operator">:</span> <span class="token string">'token'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$lookup'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'from'</span><span class="token operator">:</span> <span class="token string">'graphs'</span><span class="token punctuation">,</span>
          <span class="token string">'localField'</span><span class="token operator">:</span> <span class="token string">'tx.h'</span><span class="token punctuation">,</span>
          <span class="token string">'foreignField'</span><span class="token operator">:</span> <span class="token string">'graphTxn.txid'</span><span class="token punctuation">,</span>
          <span class="token string">'as'</span><span class="token operator">:</span> <span class="token string">'graph'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'limit'</span><span class="token operator">:</span> limit<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">unconfirmed_transactions_by_slp_address</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">address<span class="token punctuation">,</span> limit<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> skip<span class="token operator">=</span><span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">transactions_by_slp_address</span><span class="token punctuation">(</span><span class="token string">'u'</span><span class="token punctuation">,</span> address<span class="token punctuation">,</span> limit<span class="token punctuation">,</span> skip<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">confirmed_transactions_by_slp_address</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">address<span class="token punctuation">,</span> limit<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> skip<span class="token operator">=</span><span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">transactions_by_slp_address</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">,</span> address<span class="token punctuation">,</span> limit<span class="token punctuation">,</span> skip<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="tokens-by-slp-address"><a href="#tokens-by-slp-address" class="header-anchor">#</a> Tokens by SLP Address</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">tokens_by_slp_address</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">address<span class="token punctuation">,</span> limit<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> skip<span class="token operator">=</span><span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'g'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'graphTxn.outputs.address'</span><span class="token operator">:</span> address<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$unwind'</span><span class="token operator">:</span> <span class="token string">'$graphTxn.outputs'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'graphTxn.outputs.status'</span><span class="token operator">:</span> <span class="token string">'UNSPENT'</span><span class="token punctuation">,</span>
          <span class="token string">'graphTxn.outputs.address'</span><span class="token operator">:</span> address<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token string">'$tokenDetails.tokenIdHex'</span><span class="token punctuation">,</span>
          <span class="token string">'slpAmount'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$sum'</span><span class="token operator">:</span> <span class="token string">'$graphTxn.outputs.slpAmount'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$sort'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'slpAmount'</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'slpAmount'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$gt'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$lookup'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'from'</span><span class="token operator">:</span> <span class="token string">'tokens'</span><span class="token punctuation">,</span>
          <span class="token string">'localField'</span><span class="token operator">:</span> <span class="token string">'_id'</span><span class="token punctuation">,</span>
          <span class="token string">'foreignField'</span><span class="token operator">:</span> <span class="token string">'tokenDetails.tokenIdHex'</span><span class="token punctuation">,</span>
          <span class="token string">'as'</span><span class="token operator">:</span> <span class="token string">'token'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'sort'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'slpAmount'</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'skip'</span><span class="token operator">:</span> skip<span class="token punctuation">,</span>
    <span class="token string">'limit'</span><span class="token operator">:</span> limit<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="recently-created-tokens"><a href="#recently-created-tokens" class="header-anchor">#</a> Recently created tokens</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">recent_tokens</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">limit<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> skip<span class="token operator">=</span><span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'slp.detail.transactionType'</span><span class="token operator">:</span> <span class="token string">'GENESIS'</span><span class="token punctuation">,</span>
          <span class="token string">'slp.valid'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$lookup'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'from'</span><span class="token operator">:</span> <span class="token string">'tokens'</span><span class="token punctuation">,</span>
          <span class="token string">'localField'</span><span class="token operator">:</span> <span class="token string">'tx.h'</span><span class="token punctuation">,</span>
          <span class="token string">'foreignField'</span><span class="token operator">:</span> <span class="token string">'tokenDetails.tokenIdHex'</span><span class="token punctuation">,</span>
          <span class="token string">'as'</span><span class="token operator">:</span> <span class="token string">'token'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$sort'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'blk.i'</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$skip'</span><span class="token operator">:</span> skip<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$limit'</span><span class="token operator">:</span> limit<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'limit'</span><span class="token operator">:</span> limit<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="counting"><a href="#counting" class="header-anchor">#</a> Counting</h2> <h3 id="count-total-tokens"><a href="#count-total-tokens" class="header-anchor">#</a> Count Total Tokens</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">count_tokens</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
          <span class="token string">'count'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'$sum'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'r'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'f'</span><span class="token operator">:</span> <span class="token string">'[ .[] | {count: .count } ]'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="count-total-tokens-minted"><a href="#count-total-tokens-minted" class="header-anchor">#</a> Count Total Tokens Minted</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">token_get_total_minted</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tokenIdHex</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'g'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'tokenDetails.tokenIdHex'</span><span class="token operator">:</span> tokenIdHex<span class="token punctuation">,</span>
          <span class="token string">'$or'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span><span class="token string">'graphTxn.details.transactionType'</span><span class="token operator">:</span> <span class="token string">'GENESIS'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token string">'graphTxn.details.transactionType'</span><span class="token operator">:</span> <span class="token string">'MINT'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$unwind'</span><span class="token operator">:</span> <span class="token string">'$graphTxn.outputs'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
          <span class="token string">'count'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$sum'</span><span class="token operator">:</span> <span class="token string">'$graphTxn.outputs.slpAmount'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'limit'</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="count-unconfirmed-transaction-history"><a href="#count-unconfirmed-transaction-history" class="header-anchor">#</a> Count Unconfirmed Transaction History</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">count_unconfirmed_token_transaction_history</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tokenIdHex<span class="token punctuation">,</span> address<span class="token operator">=</span><span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> match<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>address <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    match <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token string">'$and'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token string">'slp.valid'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">'slp.detail.tokenIdHex'</span><span class="token operator">:</span> tokenIdHex<span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    match <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token string">'$and'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token string">'slp.valid'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">'slp.detail.tokenIdHex'</span><span class="token operator">:</span> tokenIdHex<span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">'$or'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token string">'in.e.a'</span><span class="token operator">:</span> address<span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">'out.e.a'</span><span class="token operator">:</span> address<span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'u'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token string">'$match'</span><span class="token operator">:</span> match<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            <span class="token string">'count'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'$sum'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'r'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'f'</span><span class="token operator">:</span> <span class="token string">'[ .[] | {count: .count } ]'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="count-transactions-by-block"><a href="#count-transactions-by-block" class="header-anchor">#</a> Count Transactions By Block</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">count_txs_by_block</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">height</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'$and'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span><span class="token string">'slp.valid'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token string">'blk.i'</span><span class="token operator">:</span> height<span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
          <span class="token string">'count'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'$sum'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'r'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'f'</span><span class="token operator">:</span> <span class="token string">'[ .[] | {count: .count } ]'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="count-transactions-in-mempool"><a href="#count-transactions-in-mempool" class="header-anchor">#</a> Count Transactions in Mempool</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">count_txs_in_mempool</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'u'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'slp.valid'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
          <span class="token string">'count'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'$sum'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'r'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'f'</span><span class="token operator">:</span> <span class="token string">'[ .[] | {count: .count } ]'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="count-total-mints-for-a-token"><a href="#count-total-mints-for-a-token" class="header-anchor">#</a> Count Total Mints for a Token</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">count_token_mint_transactions</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tokenIdHex</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'slp.valid'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token string">'slp.detail.tokenIdHex'</span><span class="token operator">:</span> tokenIdHex<span class="token punctuation">,</span>
          <span class="token string">'$or'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              <span class="token string">'slp.detail.transactionType'</span><span class="token operator">:</span> <span class="token string">'GENESIS'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              <span class="token string">'slp.detail.transactionType'</span><span class="token operator">:</span> <span class="token string">'MINT'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
          <span class="token string">'count'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'$sum'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'r'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'f'</span><span class="token operator">:</span> <span class="token string">'[ .[] | {count: .count } ]'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="count-total-burned-tokens"><a href="#count-total-burned-tokens" class="header-anchor">#</a> Count Total Burned Tokens</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">token_get_total_burned</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tokenIdHex</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'g'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'tokenDetails.tokenIdHex'</span><span class="token operator">:</span> tokenIdHex<span class="token punctuation">,</span>
          <span class="token string">'graphTxn.outputs.status'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$in'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token string">'SPENT_NON_SLP'</span><span class="token punctuation">,</span>
              <span class="token string">'BATON_SPENT_INVALID_SLP'</span><span class="token punctuation">,</span>
              <span class="token string">'SPENT_INVALID_SLP'</span><span class="token punctuation">,</span>
              <span class="token string">'BATON_SPENT_NON_SLP'</span><span class="token punctuation">,</span>
              <span class="token string">'MISSING_BCH_VOUT'</span><span class="token punctuation">,</span>
              <span class="token string">'BATON_MISSING_BCH_VOUT'</span><span class="token punctuation">,</span>
              <span class="token string">'BATON_SPENT_NOT_IN_MINT'</span><span class="token punctuation">,</span>
              <span class="token string">'EXCESS_INPUT_BURNED'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$unwind'</span><span class="token operator">:</span> <span class="token string">'$graphTxn.outputs'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'graphTxn.outputs.status'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$in'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token string">'SPENT_NON_SLP'</span><span class="token punctuation">,</span>
              <span class="token string">'BATON_SPENT_INVALID_SLP'</span><span class="token punctuation">,</span>
              <span class="token string">'SPENT_INVALID_SLP'</span><span class="token punctuation">,</span>
              <span class="token string">'BATON_SPENT_NON_SLP'</span><span class="token punctuation">,</span>
              <span class="token string">'MISSING_BCH_VOUT'</span><span class="token punctuation">,</span>
              <span class="token string">'BATON_MISSING_BCH_VOUT'</span><span class="token punctuation">,</span>
              <span class="token string">'BATON_SPENT_NOT_IN_MINT'</span><span class="token punctuation">,</span>
              <span class="token string">'EXCESS_INPUT_BURNED'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
          <span class="token string">'count'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$sum'</span><span class="token operator">:</span> <span class="token string">'$graphTxn.outputs.slpAmount'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'limit'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'r'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'f'</span><span class="token operator">:</span> <span class="token string">'[ .[] | {count: .count } ]'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="count-total-satoshis-locked-up"><a href="#count-total-satoshis-locked-up" class="header-anchor">#</a> Count Total Satoshis Locked Up</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">token_get_total_satoshis_locked</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tokenIdHex</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'g'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'tokenDetails.tokenIdHex'</span><span class="token operator">:</span> tokenIdHex<span class="token punctuation">,</span>
          <span class="token string">'graphTxn.outputs.status'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$in'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token string">'UNSPENT'</span><span class="token punctuation">,</span>
              <span class="token string">'BATON_UNSPENT'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$unwind'</span><span class="token operator">:</span> <span class="token string">'$graphTxn.outputs'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'graphTxn.outputs.status'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$in'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token string">'UNSPENT'</span><span class="token punctuation">,</span>
              <span class="token string">'BATON_UNSPENT'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
          <span class="token string">'count'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$sum'</span><span class="token operator">:</span> <span class="token string">'$graphTxn.outputs.bchSatoshis'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'limit'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'r'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'f'</span><span class="token operator">:</span> <span class="token string">'[ .[] | {count: .count} ]'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="count-total-tokens-minted-2"><a href="#count-total-tokens-minted-2" class="header-anchor">#</a> Count Total Tokens Minted</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">token_get_total_minted</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tokenIdHex</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'g'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'tokenDetails.tokenIdHex'</span><span class="token operator">:</span> tokenIdHex<span class="token punctuation">,</span>
          <span class="token string">'$or'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span><span class="token string">'graphTxn.details.transactionType'</span><span class="token operator">:</span> <span class="token string">'GENESIS'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token string">'graphTxn.details.transactionType'</span><span class="token operator">:</span> <span class="token string">'MINT'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$unwind'</span><span class="token operator">:</span> <span class="token string">'$graphTxn.outputs'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
          <span class="token string">'count'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$sum'</span><span class="token operator">:</span> <span class="token string">'$graphTxn.outputs.slpAmount'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'limit'</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="count-tokens-total-transactions"><a href="#count-tokens-total-transactions" class="header-anchor">#</a> Count Tokens Total Transactions</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">token_get_total_transactions</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tokenIdHex</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'g'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'tokenDetails.tokenIdHex'</span><span class="token operator">:</span> tokenIdHex<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
          <span class="token string">'count'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$sum'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'limit'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'r'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'f'</span><span class="token operator">:</span> <span class="token string">'[ .[] | {count: .count} ]'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="count-utxos-involving-a-token"><a href="#count-utxos-involving-a-token" class="header-anchor">#</a> Count UTXOs Involving a Token</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">token_get_total_utxos</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tokenIdHex</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'g'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'tokenDetails.tokenIdHex'</span><span class="token operator">:</span> tokenIdHex<span class="token punctuation">,</span>
          <span class="token string">'graphTxn.outputs.status'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$in'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token string">'UNSPENT'</span><span class="token punctuation">,</span>
              <span class="token string">'BATON_UNSPENT'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$unwind'</span><span class="token operator">:</span> <span class="token string">'$graphTxn.outputs'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'graphTxn.outputs.status'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$in'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token string">'UNSPENT'</span><span class="token punctuation">,</span>
              <span class="token string">'BATON_UNSPENT'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">'graphTxn.outputs.slpAmount'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$gt'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
          <span class="token string">'count'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$sum'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'limit'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'r'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'f'</span><span class="token operator">:</span> <span class="token string">'[ .[] | {count: .count} ]'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="count-total-addresses-associated-with-a-token"><a href="#count-total-addresses-associated-with-a-token" class="header-anchor">#</a> Count Total Addresses associated with a Token</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">token_get_total_addresses</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tokenIdHex</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'g'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'tokenDetails.tokenIdHex'</span><span class="token operator">:</span> tokenIdHex<span class="token punctuation">,</span>
          <span class="token string">'graphTxn.outputs.status'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$in'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token string">'UNSPENT'</span><span class="token punctuation">,</span>
              <span class="token string">'BATON_UNSPENT'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$unwind'</span><span class="token operator">:</span> <span class="token string">'$graphTxn.outputs'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'graphTxn.outputs.status'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$in'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token string">'UNSPENT'</span><span class="token punctuation">,</span>
              <span class="token string">'BATON_UNSPENT'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">'graphTxn.outputs.slpAmount'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$gt'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token string">'$graphTxn.outputs.address'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
          <span class="token string">'count'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$sum'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'limit'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'r'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'f'</span><span class="token operator">:</span> <span class="token string">'[ .[] | {count: .count} ]'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="count-token-burn-transactions"><a href="#count-token-burn-transactions" class="header-anchor">#</a> Count Token Burn Transactions</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">count_token_burn_transactions</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tokenIdHex</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'g'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'tokenDetails.tokenIdHex'</span><span class="token operator">:</span> tokenIdHex<span class="token punctuation">,</span>
          <span class="token string">'graphTxn.outputs'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$elemMatch'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string">'status'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string">'$in'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                  <span class="token string">'SPENT_NON_SLP'</span><span class="token punctuation">,</span>
                  <span class="token string">'BATON_SPENT_INVALID_SLP'</span><span class="token punctuation">,</span>
                  <span class="token string">'SPENT_INVALID_SLP'</span><span class="token punctuation">,</span>
                  <span class="token string">'BATON_SPENT_NON_SLP'</span><span class="token punctuation">,</span>
                  <span class="token string">'MISSING_BCH_VOUT'</span><span class="token punctuation">,</span>
                  <span class="token string">'BATON_MISSING_BCH_VOUT'</span><span class="token punctuation">,</span>
                  <span class="token string">'BATON_SPENT_NOT_IN_MINT'</span><span class="token punctuation">,</span>
                  <span class="token string">'EXCESS_INPUT_BURNED'</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string">'slpAmount'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string">'$gt'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
          <span class="token string">'count'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'$sum'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'r'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'f'</span><span class="token operator">:</span> <span class="token string">'[ .[] | {count: .count } ]'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="count-an-addresses-total-burn-transactions"><a href="#count-an-addresses-total-burn-transactions" class="header-anchor">#</a> Count an Addresses Total Burn Transactions</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">count_address_burn_transactions</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">address</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'g'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'$or'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              <span class="token string">'graphTxn.outputs'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string">'$elemMatch'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token string">'address'</span><span class="token operator">:</span> address<span class="token punctuation">,</span>
                  <span class="token string">'status'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token string">'$in'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                      <span class="token string">'SPENT_NON_SLP'</span><span class="token punctuation">,</span>
                      <span class="token string">'BATON_SPENT_INVALID_SLP'</span><span class="token punctuation">,</span>
                      <span class="token string">'SPENT_INVALID_SLP'</span><span class="token punctuation">,</span>
                      <span class="token string">'BATON_SPENT_NON_SLP'</span><span class="token punctuation">,</span>
                      <span class="token string">'MISSING_BCH_VOUT'</span><span class="token punctuation">,</span>
                      <span class="token string">'BATON_MISSING_BCH_VOUT'</span><span class="token punctuation">,</span>
                      <span class="token string">'BATON_SPENT_NOT_IN_MINT'</span><span class="token punctuation">,</span>
                      <span class="token string">'EXCESS_INPUT_BURNED'</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token string">'slpAmount'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token string">'$gt'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              <span class="token string">'graphTxn.inputs.address'</span><span class="token operator">:</span> address<span class="token punctuation">,</span>
              <span class="token string">'graphTxn.outputs'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string">'$elemMatch'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token string">'status'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token string">'$in'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                      <span class="token string">'SPENT_NON_SLP'</span><span class="token punctuation">,</span>
                      <span class="token string">'BATON_SPENT_INVALID_SLP'</span><span class="token punctuation">,</span>
                      <span class="token string">'SPENT_INVALID_SLP'</span><span class="token punctuation">,</span>
                      <span class="token string">'BATON_SPENT_NON_SLP'</span><span class="token punctuation">,</span>
                      <span class="token string">'MISSING_BCH_VOUT'</span><span class="token punctuation">,</span>
                      <span class="token string">'BATON_MISSING_BCH_VOUT'</span><span class="token punctuation">,</span>
                      <span class="token string">'BATON_SPENT_NOT_IN_MINT'</span><span class="token punctuation">,</span>
                      <span class="token string">'EXCESS_INPUT_BURNED'</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token string">'slpAmount'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token string">'$gt'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
          <span class="token string">'count'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'$sum'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'r'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'f'</span><span class="token operator">:</span> <span class="token string">'[ .[] | {count: .count } ]'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="count-total-token-burn-transactions"><a href="#count-total-token-burn-transactions" class="header-anchor">#</a> Count Total Token Burn Transactions</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">count_total_burn_transactions</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'g'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'graphTxn.outputs'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$elemMatch'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string">'status'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string">'$in'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                  <span class="token string">'SPENT_NON_SLP'</span><span class="token punctuation">,</span>
                  <span class="token string">'BATON_SPENT_INVALID_SLP'</span><span class="token punctuation">,</span>
                  <span class="token string">'SPENT_INVALID_SLP'</span><span class="token punctuation">,</span>
                  <span class="token string">'BATON_SPENT_NON_SLP'</span><span class="token punctuation">,</span>
                  <span class="token string">'MISSING_BCH_VOUT'</span><span class="token punctuation">,</span>
                  <span class="token string">'BATON_MISSING_BCH_VOUT'</span><span class="token punctuation">,</span>
                  <span class="token string">'BATON_SPENT_NOT_IN_MINT'</span><span class="token punctuation">,</span>
                  <span class="token string">'EXCESS_INPUT_BURNED'</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string">'slpAmount'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string">'$gt'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
          <span class="token string">'count'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'$sum'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'r'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'f'</span><span class="token operator">:</span> <span class="token string">'[ .[] | {count: .count } ]'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="count-of-tokens-an-address-holds"><a href="#count-of-tokens-an-address-holds" class="header-anchor">#</a> Count of Tokens an Address Holds</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">count_tokens_by_slp_address</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">address</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'g'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'graphTxn.outputs.address'</span><span class="token operator">:</span> address<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$unwind'</span><span class="token operator">:</span> <span class="token string">'$graphTxn.outputs'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'graphTxn.outputs.status'</span><span class="token operator">:</span> <span class="token string">'UNSPENT'</span><span class="token punctuation">,</span>
          <span class="token string">'graphTxn.outputs.address'</span><span class="token operator">:</span> address<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token string">'$tokenDetails.tokenIdHex'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
          <span class="token string">'count'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'$sum'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'r'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'f'</span><span class="token operator">:</span> <span class="token string">'[ .[] | {count: .count } ]'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="total-transactions-by-address"><a href="#total-transactions-by-address" class="header-anchor">#</a> Total Transactions by Address</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">count_total_transactions_by_slp_address</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">address</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">'c'</span><span class="token punctuation">,</span>
      <span class="token string">'u'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'$and'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              <span class="token string">'$or'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span><span class="token string">'in.e.a'</span><span class="token operator">:</span> address<span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span><span class="token string">'out.e.a'</span><span class="token operator">:</span> address<span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token string">'slp.valid'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
          <span class="token string">'count'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'$sum'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'r'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'f'</span><span class="token operator">:</span> <span class="token string">'[ .[] | {count: .count } ]'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="count-address-s-sent-transactions"><a href="#count-address-s-sent-transactions" class="header-anchor">#</a> Count Address's Sent Transactions</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">count_address_sent_transactions</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">address</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'g'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'graphTxn.inputs.address'</span><span class="token operator">:</span> address<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
          <span class="token string">'count'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'$sum'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'r'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'f'</span><span class="token operator">:</span> <span class="token string">'[ .[] | {count: .count } ]'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="count-address-s-received-transactions"><a href="#count-address-s-received-transactions" class="header-anchor">#</a> Count Address's Received Transactions</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">count_address_recv_transactions</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">address</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'g'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'graphTxn.inputs.address'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$ne'</span><span class="token operator">:</span> address<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">'graphTxn.outputs.address'</span><span class="token operator">:</span> address<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
          <span class="token string">'count'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">'$sum'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'r'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'f'</span><span class="token operator">:</span> <span class="token string">'[ .[] | {count: .count } ]'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="dividend-calculations"><a href="#dividend-calculations" class="header-anchor">#</a> Dividend Calculations</h2> <h3 id="calculate-dividends-from-mempool"><a href="#calculate-dividends-from-mempool" class="header-anchor">#</a> Calculate Dividends from Mempool</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">dividend_calculate_bch_mempool</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tokenIdHex<span class="token punctuation">,</span> slp_supply<span class="token punctuation">,</span> bch_amount<span class="token punctuation">,</span> ignoreAddresses</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'g'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'tokenDetails.tokenIdHex'</span><span class="token operator">:</span> tokenIdHex<span class="token punctuation">,</span>
          <span class="token string">'graphTxn.outputs.status'</span><span class="token operator">:</span> <span class="token string">'UNSPENT'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$unwind'</span><span class="token operator">:</span> <span class="token string">'$graphTxn.outputs'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'graphTxn.outputs.status'</span><span class="token operator">:</span> <span class="token string">'UNSPENT'</span><span class="token punctuation">,</span>
          <span class="token string">'graphTxn.outputs.address'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$nin'</span><span class="token operator">:</span> ignoreAddresses<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token string">'$graphTxn.outputs.address'</span><span class="token punctuation">,</span>
          <span class="token string">'slpAmount'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$sum'</span><span class="token operator">:</span> <span class="token string">'$graphTxn.outputs.slpAmount'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$sort'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'slpAmount'</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$project'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token string">'bchAmount'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$divide'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'$slpAmount'</span><span class="token punctuation">,</span> slp_supply<span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$project'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token string">'bchAmount'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$multiply'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'$bchAmount'</span><span class="token punctuation">,</span> bch_amount<span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$limit'</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
       <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'bchAmount'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$gte'</span><span class="token operator">:</span> <span class="token number">0.00000546</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'limit'</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'r'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'f'</span><span class="token operator">:</span> <span class="token string">'[ .[] | { address: ._id, bchAmount: .bchAmount } ]'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="dividend-ignore-amount-from-mempool"><a href="#dividend-ignore-amount-from-mempool" class="header-anchor">#</a> Dividend Ignore Amount from Mempool</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">dividend_count_ignore_amounts</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tokenIdHex<span class="token punctuation">,</span> addresses</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'v'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'db'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'g'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'aggregate'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'tokenDetails.tokenIdHex'</span><span class="token operator">:</span> tokenIdHex<span class="token punctuation">,</span>
          <span class="token string">'graphTxn.outputs.status'</span><span class="token operator">:</span> <span class="token string">'UNSPENT'</span><span class="token punctuation">,</span>
          <span class="token string">'graphTxn.outputs.address'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$in'</span><span class="token operator">:</span> addresses<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$unwind'</span><span class="token operator">:</span> <span class="token string">'$graphTxn.outputs'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$match'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'graphTxn.outputs.status'</span><span class="token operator">:</span> <span class="token string">'UNSPENT'</span><span class="token punctuation">,</span>
          <span class="token string">'graphTxn.outputs.address'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$in'</span><span class="token operator">:</span> addresses<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">'$group'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'_id'</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
          <span class="token string">'count'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'$sum'</span><span class="token operator">:</span> <span class="token string">'$graphTxn.outputs.slpAmount'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'r'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'f'</span><span class="token operator">:</span> <span class="token string">'[ .[] | {count: .count } ]'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <div class="content-footer" data-v-4c735fbc><footer class="page-edit" data-v-4c735fbc><div class="edit-link"><a href="https://github.com/simpleledger/simpleledger.github.io/edit/develop/docs/tooling/slpdb_examples.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/2/2020, 11:45:28 PM</span></div></footer> <div class="page-nav" data-v-4c735fbc><p class="inner"><span class="prev">
      
      <a href="/tooling/slpdb/" class="prev">
        SLPDB
      </a></span> <span class="next"><a href="/tooling/slpserve/">
        SLPServe
      </a>
      
    </span></p></div></div> <div data-v-4c735fbc></div> <div data-v-4c735fbc></div> </main></div><div class="global-ui"><!----><div></div></div></div>
    <script src="/assets/js/app.727bd0bc.js" defer></script><script src="/assets/js/2.59409279.js" defer></script><script src="/assets/js/6.cb6c63cc.js" defer></script><script src="/assets/js/61.a94ff6cf.js" defer></script>
  </body>
</html>
